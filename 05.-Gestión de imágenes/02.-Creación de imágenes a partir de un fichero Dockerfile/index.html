
<!DOCTYPE html>

<html class="no-js" lang="es">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../01.-Imagen%20a%20partir%20de%20un%20contenedor/" rel="prev"/>
<link href="../02.-Instrucciones%20de%20dockerfile/" rel="next"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.4.2, mkdocs-material-9.1.4" name="generator"/>
<title>02.-Creación de imágenes a partir de un fichero Dockerfile - Sistemas Informáticos</title>
<link href="../../assets/stylesheets/main.240905d7.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.a0c5b2b5.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="green" data-md-color-primary="blue-grey" data-md-color-scheme="default" dir="ltr">
<script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#el-fichero-dockerfile">
          Saltar a contenido
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Cabecera" class="md-header__inner md-grid">
<a aria-label="Sistemas Informáticos" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Sistemas Informáticos">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Sistemas Informáticos
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              02.-Creación de imágenes a partir de un fichero Dockerfile
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="green" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="blue-grey" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="green" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="blue-grey" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"></path></svg>
</label>
</form>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Búsqueda" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Búsqueda" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Buscar" class="md-search__options">
<button aria-label="Limpiar" class="md-search__icon md-icon" tabindex="-1" title="Limpiar" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="Pestañas" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../..">
      docker
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../01.-Introducci%C3%B3n/">
      01.-Introducción
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../02.-Instalaci%C3%B3n/">
        02.-Instalación
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../03.-Conceptos%20Clave/">
        03.-Conceptos Clave
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../04.-Manos%20a%20la%20obra/">
        04.-Manos a la obra
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link md-tabs__link--active" href="../">
        05.-Gestión de imágenes
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../06.-Ejercicios/">
      06.-Ejercicios
    </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navegación" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Sistemas Informáticos" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Sistemas Informáticos">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
    Sistemas Informáticos
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
        docker
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../01.-Introducci%C3%B3n/">
        01.-Introducción
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../02.-Instalaci%C3%B3n/">02.-Instalación</a>
<label for="__nav_3">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          02.-Instalación
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../02.-Instalaci%C3%B3n/01.-Instalaci%C3%B3n%20r%C3%A1pida%20en%20Arch%20Linux/">
        01.-Instalación rápida en Arch Linux
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../02.-Instalaci%C3%B3n/02.-Instalaci%C3%B3n%20r%C3%A1pida%20en%20Fedora/">
        02.-Instalación rápida en Fedora
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../02.-Instalaci%C3%B3n/03.-Instalaci%C3%B3n%20r%C3%A1pida%20en%20Ubuntu/">
        03.-Instalación rápida en Ubuntu
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../02.-Instalaci%C3%B3n/04.-Instalaci%C3%B3n%20r%C3%A1pida%20en%20Ubuntu/">
        04.-Instalación rápida en Ubuntu
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../02.-Instalaci%C3%B3n/05.-Instalaci%C3%B3n%20r%C3%A1pida%20en%20Ubuntu/">
        05.-Instalación rápida en Ubuntu
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../02.-Instalaci%C3%B3n/06.-Instalaci%C3%B3n%20r%C3%A1pida%20en%20Ubuntu/">
        06.-Instalación rápida en Ubuntu
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../03.-Conceptos%20Clave/">03.-Conceptos Clave</a>
<label for="__nav_4">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          03.-Conceptos Clave
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
          01.-Imágenes
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_2">
<span class="md-nav__icon md-icon"></span>
          01.-Imágenes
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../03.-Conceptos%20Clave/01.-Im%C3%A1genes/01.-Im%C3%A1genes/">
        01.-Imágenes
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../03.-Conceptos%20Clave/01.-Im%C3%A1genes/02.-Docker%20Hub/">
        02.-Docker Hub
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../03.-Conceptos%20Clave/02.-Contenedores/">
        02.-Contenedores
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../03.-Conceptos%20Clave/03.-Vol%C3%BAmenes/">
        03.-Volúmenes
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../03.-Conceptos%20Clave/04.-Capas/">
        04.-Capas
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../03.-Conceptos%20Clave/05.-Redes/">
        05.-Redes
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../03.-Conceptos%20Clave/06.-Estructura%20de%20docker/">
        06.-Estructura de docker
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../04.-Manos%20a%20la%20obra/">04.-Manos a la obra</a>
<label for="__nav_5">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
          04.-Manos a la obra
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../04.-Manos%20a%20la%20obra/01.-Versi%C3%B3n%20y%20Gesti%C3%B3n%20del%20Servicio/">
        01.-Versión y Gestión del Servicio
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../04.-Manos%20a%20la%20obra/02.-Usar%20el%20comando%20docker/">
        02.-Usar el comando docker
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../04.-Manos%20a%20la%20obra/03.-Trabajar%20con%20im%C3%A1genes%20de%20docker/">
        03.-Trabajar con imágenes de docker
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../04.-Manos%20a%20la%20obra/04.-Ejecutar%20un%20contenedor%20de%20Docker/">
        04.-Ejecutar un contenedor de Docker
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../04.-Manos%20a%20la%20obra/05.-Administrar%20contenedores%20de%20docker/">
        05.-Administrar contenedores de docker
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../04.-Manos%20a%20la%20obra/06.-Creaci%C3%B3n%20de%20una%20imagen%20personalizada%20a%20partir%20de%20un%20contenedor/">
        06.-Creación de una imagen personalizada a partir de un contenedor
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../04.-Manos%20a%20la%20obra/07.-Guardar%20im%C3%A1genes%20de%20docker%20en%20un%20repositorio%20de%20docker/">
        07.-Guardar imágenes de docker en un repositorio de docker
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../04.-Manos%20a%20la%20obra/08.-Variables%20de%20entorno/">
        08.-Variables de entorno
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../04.-Manos%20a%20la%20obra/09.-Practica%20con%20Docker%20Playground/">
        09.-Practica con Docker Playground
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../04.-Manos%20a%20la%20obra/10.-Limpi%C3%A1ndolo%20todo/">
        10.-Limpiándolo todo
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_6" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../">05.-Gestión de imágenes</a>
<label for="__nav_6">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
          05.-Gestión de imágenes
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../01.-Dockerfile/">
        01.-Dockerfile
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../01.-Imagen%20a%20partir%20de%20un%20contenedor/">
        01.-Imagen a partir de un contenedor
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          02.-Creación de imágenes a partir de un fichero Dockerfile
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        02.-Creación de imágenes a partir de un fichero Dockerfile
      </a>
<nav aria-label="Tabla de contenidos" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#el-fichero-dockerfile">
    El fichero Dockerfile
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#-add-es-similar-a-copy-pero-tiene-funcionalidades-adicionales-como-especificar-urls-y-tratar-archivos-comprimidos">
    - ADD: Es similar a COPY pero tiene funcionalidades adicionales como especificar URLs y tratar archivos comprimidos.
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../02.-Instrucciones%20de%20dockerfile/">
        02.-Instrucciones de dockerfile
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../03.-Construcci%C3%B3n%20de%20una%20imagen/">
        03.-Construcción de una imagen
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../04.-Etiquetado%20de%20im%C3%A1genes/">
        04.-Etiquetado de imágenes
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../05.-Subir%20im%C3%A1genes/">
        05.-Subir imágenes
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../06.-Ejercicios/">
        06.-Ejercicios
      </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Tabla de contenidos" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#el-fichero-dockerfile">
    El fichero Dockerfile
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#-add-es-similar-a-copy-pero-tiene-funcionalidades-adicionales-como-especificar-urls-y-tratar-archivos-comprimidos">
    - ADD: Es similar a COPY pero tiene funcionalidades adicionales como especificar URLs y tratar archivos comprimidos.
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1>02.-Creación de imágenes a partir de un fichero Dockerfile</h1>
<p>El método anterior tiene algunos inconvenientes:</p>
<ul>
<li>
<p><strong>No se puede reproducir la imagen</strong>. Si la perdemos tenemos que recordar toda la secuencia de órdenes que habíamos ejecutado desde que arrancamos el contenedor hasta que teníamos una versión definitiva e hicimos <code>docker commit</code>.</p>
</li>
<li>
<p><strong>No podemos configurar el proceso que se ejecutará en el contenedor creado desde la imagen</strong>. Los contenedores creados a partir de la nueva imagen ejecutaran por defecto el proceso que estaba configurado en la imagen base.</p>
</li>
<li>
<p><strong>No podemos cambiar la imagen de base</strong>. Si ha habido alguna actualización, problemas de seguridad, etc. con la imagen de base tenemos que descargar la nueva versión, volver a crear un nuevo contenedor basado en ella y ejecutar de nuevo toda la secuencia de órdenes.</p>
</li>
</ul>
<p>Por todas estas razones, <strong>el método preferido para la creación de imágenes es el uso de ficheros <code>dockerfile</code> y el comando <code>docker build</code></strong>. Con este método vamos a tener las siguientes ventajas:</p>
<ul>
<li>
<p>Podremos reproducir la imagen fácilmente ya que en el fichero <code>dockerfile</code> tenemos todas y cada una de las órdenes necesarias para la construcción de la imagen. Si además ese Dockerfile está guardado en un sistema de control de versiones como git podremos, no sólo reproducir la imagen si no asociar los cambios en el Dockerfile a los cambios en las versiones de las imágenes creadas.</p>
</li>
<li>
<p>Podremos configurar el proceso que se ejecutará por defecto en los contenedores creados a partir de la nueva imagen.</p>
</li>
<li>
<p>Si queremos cambiar la imagen de base esto es extremadamente sencillo con un Dockerfile, únicamente tendremos que modificar la primera línea de ese fichero tal y como explicaremos posteriormente.</p>
</li>
</ul>
<h2 id="el-fichero-dockerfile">El fichero Dockerfile<a class="headerlink" href="#el-fichero-dockerfile" title="Permanent link">¶</a></h2>
<p>Un fichero Dockerfile es un conjunto de instrucciones que serán ejecutadas de forma secuencial para construir una nueva imagen docker. Cada una de estas instrucciones crea una nueva capa en la imagen que estamos creando.</p>
<p>Hay varias instrucciones que podemos usar en la construcción de un Dockerfile, pero la estructura fundamental del fichero es:
- Indicamos imagen base: FROM
- Metadatos: LABEL
- Instrucciones de construcción: RUN, COPY, ADD, WORKDIR
- Configuración: Variable de entornos, usuarios, puertos: USER, EXPOSE, ENV
- Instrucciones de arranque: CMD, ENTRYPOINT</p>
<p>Veamos las principales instrucciones que podemos usar:</p>
<ul>
<li>
<p>FROM: Sirve para especificar la imagen sobre la que voy a construir la mía. Ejemplo: FROM php:7.4-apache.</p>
</li>
<li>
<p>LABEL: Sirve para añadir metadatos a la imagen mediante clave=valor. Ejemplo: LABEL company=iesalixar.</p>
</li>
<li>
<p>COPY: Para copiar ficheros desde mi equipo a la imagen. Esos ficheros deben estar en el mismo contexto (carpeta o repositorio). Su sintaxis es <code>COPY [--chown=&lt;usuario&gt;:&lt;grupo&gt;] src dest</code>. Por ejemplo: <code>COPY --chown=www-data:www-data myapp /var/www/html</code>.</p>
</li>
</ul>
<h2 id="-add-es-similar-a-copy-pero-tiene-funcionalidades-adicionales-como-especificar-urls-y-tratar-archivos-comprimidos">- ADD: Es similar a COPY pero tiene funcionalidades adicionales como especificar URLs y tratar archivos comprimidos.<a class="headerlink" href="#-add-es-similar-a-copy-pero-tiene-funcionalidades-adicionales-como-especificar-urls-y-tratar-archivos-comprimidos" title="Permanent link">¶</a></h2>
<ul>
<li>RUN: Ejecuta una orden creando una nueva capa. Su sintaxis es RUN orden / RUN ["orden","param1","param2"]. Ejemplo: RUN apt update &amp;&amp; apt install -y git. En este caso es muy importante que pongamos la opción -y porque en el proceso de construcción no puede haber interacción con el usuario.
    WORKDIR: Establece el directorio de trabajo dentro de la imagen que estoy creando para posteriormente usar las órdenes RUN,COPY,ADD,CMD o ENTRYPOINT. Ejemplo: WORKDIR /usr/local/apache/htdocs.
    EXPOSE: Nos da información acerca de qué puertos tendrá abiertos el contenedor cuando se cree uno en base a la imagen que estamos creando. Es meramente informativo. Ejemplo: EXPOSE 80.
    USER: Para especificar (por nombre o UID/GID) el usuario de trabajo para todas las órdenes RUN,CMD Y ENTRYPOINT posteriores. Ejemplos: USER jenkins / USER 1001:10001.
    ARG: Para definir variables para las cuales los usuarios pueden especificar valores a la hora de hacer el proceso de build mediante el flag --build-arg. Su sintaxis es ARG nombre_variable o ARG nombre_variable=valor_por_defecto. Posteriormente esa variable se puede usar en el resto de la órdenes de la siguiente manera $nombre_variable. Ejemplo: ARG usuario=www-data. No se puede usar con ENTRYPOINT Y CMD.
    ENV: Para establecer variables de entorno dentro del contenedor. Puede ser usado posteriormente en las órdenes RUN añadiendo $ delante de el nombre de la variable de entorno. Ejemplo: ENV WEB_DOCUMENT_ROOT=/var/www/html. No se puede usar con ENTRYPOINT Y CMD.
    ENTRYPOINT: Para establecer el ejecutable que se lanza siempre cuando se crea el contenedor con docker run, salvo que se especifique expresamente algo diferente con el flag --entrypoint. Su síntaxis es la siguiente: ENTRYPOINT <command/> / ENTRYPOINT ["executable","param1","param2"]. Ejemplo: ENTRYPOINT ["/usr/sbin/apache2ctl","-D","FOREGROUND"].
    CMD: Para establecer el ejecutable por defecto (salvo que se sobreescriba desde la orden docker run) o para especificar parámetros para un ENTRYPOINT. Si tengo varios sólo se ejecuta el último. Su sintaxis es CMD param1 param2 / CMD ["param1","param2"] / CMD["command","param1"]. Ejemplo: CMD [“-c” “/etc/nginx.conf”] / ENTRYPOINT [“nginx”].</li>
</ul>
<p>Para una descripción completa sobre el fichero Dockerfile, puedes acceder a la documentación oficial.
Construyendo imágenes con docker build</p>
<p>El comando docker build construye la nueva imagen leyendo las instrucciones del fichero Dockerfile y la información de un entorno, que para nosotros va a ser un directorio (aunque también podemos guardar información, por ejemplo, en un repositorio git).</p>
<p>La creación de la imagen es ejecutada por el docker engine, que recibe toda la información del entorno, por lo tanto es recomendable guardar el Dockerfile en un directorio vacío y añadir los ficheros necesarios para la creación de la imagen. El comando docker build ejecuta las instrucciones de un Dockerfile línea por línea y va mostrando los resultados en pantalla.</p>
<p>Tenemos que tener en cuenta que cada instrucción ejecutada crea una imagen intermedia, una vez finalizada la construcción de la imagen nos devuelve su id. Algunas imágenes intermedias se guardan en caché, otras se borran. Por lo tanto, si por ejemplo, en un comando ejecutamos cd /scripts/ y en otra linea le mandamos a ejecutar un script (./install.sh) no va a funcionar, ya que ha lanzado otra imagen intermedia. Teniendo esto en cuenta, la manera correcta de hacerlo sería:</p>
<p>cd /scripts/;./install.sh</p>
<p>Para terminar indicar que la creación de imágenes intermedias generadas por la ejecución de cada instrucción del Dockerfile, es un mecanismo de caché, es decir, si en algún momento falla la creación de la imagen, al corregir el Dockerfile y volver a construir la imagen, los pasos que habían funcionado anteriormente no se repiten ya que tenemos a nuestra disposición las imágenes intermedias, y el proceso continúa por la instrucción que causó el fallo.
Ejemplo de Dockerfile</p>
<p>Vamos a crear un directorio (nuestro entorno) donde vamos a crear un Dockerfile y un fichero index.html:</p>
<p>cd build
~/build$ ls
Dockerfile  index.html</p>
<p>El contenido de Dockerfile es:</p>
<p>FROM debian:buster-slim
MAINTAINER José Domingo Muñoz "josedom24@gmail.com"
RUN apt-get update  &amp;&amp; apt-get install -y  apache2 
COPY index.html /var/www/html/
CMD ["/usr/sbin/apache2ctl", "-D", "FOREGROUND"]</p>
<p>Para crear la imagen uso el comando docker build, indicando el nombre de la nueva imagen (opción -t) y indicando el directorio contexto.</p>
<p>$ docker build -t josedom24/myapache2:v2 .
...</p>
<pre><code>Nota: Pongo como directorio el . poruqe estoy ejecutando esta instrucción dentro del directorio donde está el Dockerfile.
</code></pre>
<p>Una vez terminado, podríamos ver que hemos generado una nueva imagen:</p>
<p>$ docker images
REPOSITORY                TAG                 IMAGE ID            CREATED             SIZE
josedom24/myapache2       v2                  3bd28de7ae88        43 seconds ago      195MB
...</p>
<p>Si usamos el parámetro --no-cache en docker build haríamos la construcción de una imagen sin usar las capas cacheadas por haber realizado anteriormente imágenes con capas similares.</p>
<p>En este caso al crear el contenedor a partir de esta imagen no hay que indicar el proceso que se va a ejecutar, porque ya se ha indicando en el fichero Dockerfile:</p>
<p>$ docker run -d -p 8080:80 --name servidor_web josedom24/myapache2:v2 </p>
<p>Buenas prácticas al crear Dockerfile</p>
<pre><code>Los contenedores deber ser “efímeros”: Cuando decimos “efímeros” queremos decir que la creación, parada, despliegue de los contenedores creados a partir de la imagen que vamos a generar con nuestro Dockerfile debe tener una mínima configuración.
Uso de ficheros .dockerignore: Como hemos indicado anteriormente, todos los ficheros del contexto se envían al docker engine, es recomendable usar un directorio vacío donde vamos creando los ficheros que vamos a enviar. Además, para aumentar el rendimiento, y no enviar al daemon ficheros innecesarios podemos hacer uso de un fichero .dockerignore, para excluir ficheros y directorios.
No instalar paquetes innecesarios: Para reducir la complejidad, dependencias, tiempo de creación y tamaño de la imagen resultante, se debe evitar instalar paquetes extras o innecesarios. Si algún paquete no es necesario durante la creación de la imagen, lo mejor es desinstalarlo durante el proceso.
Minimizar el número de capas: Debemos encontrar el balance entre la legibilidad del Dockerfile y minimizar el número de capa que utiliza.

Indicar las instrucciones a ejecutar en múltiples líneas: Cada vez que sea posible y para hacer más fácil futuros cambios, hay que organizar los argumentos de las instrucciones que contengan múltiples líneas, esto evitará la duplicación de paquetes y hará que el archivo sea más fácil de leer. Por ejemplo:

  RUN apt-get update &amp;&amp; apt-get install -y \
  git \
  wget \
  apache2 \
  php5
</code></pre>
</article>
</div>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg>
            Volver al principio
          </button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["navigation.top", "navigation.top.sticky", "navigation.tabs", "navigation.indexes"], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}}</script>
<script src="../../assets/javascripts/bundle.19047be9.min.js"></script>
<script src="../../javascripts/mathjax.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</body>
</html>